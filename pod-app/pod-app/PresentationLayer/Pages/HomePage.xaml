<Page x:Class="pod_app.PresentationLayer.Pages.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:pod_app.PresentationLayer.Pages"
      mc:Ignorable="d"
      d:DesignHeight="600"
      d:DesignWidth="1000"
      Title="HomePage"
      Background="#1F1F21"
      UseLayoutRounding="True"
      xmlns:views="clr-namespace:pod_app.PresentationLayer.Views"
      xmlns:models="clr-namespace:pod_app.Models">

    <Page.Resources>
        <DropShadowEffect x:Key="ShadowEffect"
                          Color="Black"
                          BlurRadius="15"
                          ShadowDepth="0"
                          Opacity="1" />
        
        <Storyboard x:Key="ToastStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                     From="0" To="1"
                     Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                     BeginTime="0:0:01.2"
                     From="1" To="0"
                     Duration="0:0:0.3"/>
        </Storyboard>

    </Page.Resources>

    <ScrollViewer ScrollChanged="ScrollContainer_ScrollChanged"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
        <Grid>

            <!-- Naviagte to Savedpage button -->
            <Button Width="120"
                    Height="35"
                    Margin="10,22,0,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Click="Button_Click"
                    Content="Sparade"
                    Background="#1f1f1f"
                    Foreground="White"
                    Effect="{StaticResource ShadowEffect}"
                    FontSize="14">
                <Button.Resources>
                    <Style TargetType="{x:Type Border}">
                        <Setter Property="CornerRadius"
                                Value="20" />
                    </Style>
                </Button.Resources>
            </Button>

            <!-- Main container -->
            <Grid>
                <Grid.RowDefinitions>
                    <!-- podcast info-->
                    <RowDefinition MaxHeight="300"
                                   MinHeight="200"
                                   Height="4*" />
                    <!-- Search bar -->
                    <RowDefinition Height="50" />
                    <!-- Results -->
                    <RowDefinition Height="7*" />
                </Grid.RowDefinitions>

                <!-- podcast info-->
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            Height="auto">
                    <Border SnapsToDevicePixels="True"
                            Effect="{StaticResource ShadowEffect}"
                            HorizontalAlignment="Center"
                            Grid.Column="0"
                            Height="150"
                            Width="150"
                            CornerRadius="150"
                            RenderTransformOrigin="0.5,0.5">

                        <Border.Background>
                            <ImageBrush ImageSource="{Binding PodcastImageUrl.Value}"
                                        RenderOptions.BitmapScalingMode="HighQuality"
                                        d:ImageSource="https://hips.hearstapps.com/clv.h-cdn.co/assets/16/18/gettyimages-586890581.jpg?crop=0.668xw:1.00xh;0.219xw,0" />

                        </Border.Background>

                        <Border.RenderTransform>
                            <RotateTransform Angle="0" />
                        </Border.RenderTransform>

                        <!-- Spin animation -->
                        <Border.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(RotateTransform.Angle)"
                                                         From="0"
                                                         To="360"
                                                         Duration="0:0:10"
                                                         RepeatBehavior="Forever" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Border.Triggers>

                    </Border>

                    <TextBlock Text="{Binding PodcastTitle.Value}"
                               d:Text="Test title"
                               TextAlignment="Center"
                               FontSize="20"
                               FontWeight="Light"
                               Foreground="White" />
                </StackPanel>

                <!-- Search panel -->
                <Grid Grid.Row="1"
                      VerticalAlignment="Center"
                      HorizontalAlignment="Center">

                    <Grid.ColumnDefinitions>
                        <!-- Search bar -->
                        <ColumnDefinition Width="Auto" />
                        <!-- Spacing -->
                        <ColumnDefinition Width="10" />
                        <!-- Search button -->
                        <ColumnDefinition Width="Auto" />
                        <!-- Spacing -->
                        <ColumnDefinition Width="10" />
                        <!-- Spacing -->
                        <ColumnDefinition Width="Auto" />

                    </Grid.ColumnDefinitions>

                    <!-- On focus and un-focused animation -->
                    <Grid.Triggers>
                        <!-- On focus -->
                        <EventTrigger RoutedEvent="GotFocus"
                                      SourceName="SearchBox">
                            <BeginStoryboard>
                                <Storyboard>

                                    <DoubleAnimation Storyboard.TargetName="SearchBarBorder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="1"
                                                     Duration="0:0:0.2" />

                                    <DoubleAnimation Storyboard.TargetName="SearchBarBorder"
                                                     Storyboard.TargetProperty="Width"
                                                     To="300"
                                                     Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CircleEase EasingMode="EaseOut" />
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>

                        <!-- On search pressed -->
                        <EventTrigger RoutedEvent="Button.Click"
                                      SourceName="SearchButton">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="SearchBarBorder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0.9"
                                                     Duration="0:0:0.2" />

                                    <DoubleAnimation Storyboard.TargetName="SearchBarBorder"
                                                     Storyboard.TargetProperty="Width"
                                                     To="200"
                                                     Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CircleEase EasingMode="EaseOut" />
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Grid.Triggers>

                    <!-- Sökfält -->
                    <Border Grid.Column="0"
                            Background="White"
                            CornerRadius="20"
                            Padding="10,5"
                            Height="40"
                            Width="200"
                            x:Name="SearchBarBorder"
                            Effect="{StaticResource ShadowEffect}">

                        <TextBox SnapsToDevicePixels="True"
                                 x:Name="SearchBox"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 FontSize="16"
                                 Foreground="Black"
                                 VerticalContentAlignment="Center" />
                    </Border>

                    <!-- Sökknapp -->
                    <Border Grid.Column="2"
                            Background="White"
                            CornerRadius="20"
                            Width="40"
                            Height="40"
                            Effect="{StaticResource ShadowEffect}"
                            VerticalAlignment="Center">
                        <Button SnapsToDevicePixels="True"
                                x:Name="SearchButton"
                                Background="Transparent"
                                BorderThickness="0"
                                FontSize="16"
                                Padding="0"
                                Cursor="Hand"
                                Click="SearchButton_Click">
                            <!-- Ikon -->
                            🔍
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border CornerRadius="20"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Border>

                    <!-- Sort button -->
                    <Border Grid.Column="4"
                            Background="White"
                            CornerRadius="12"
                            Width="40"
                            Height="25"
                            Effect="{StaticResource ShadowEffect}"
                            VerticalAlignment="Center">

                        <Button Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                Cursor="Hand"
                                Foreground="Black"
                                Click="FilterButton_Click">

                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border CornerRadius="17"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>

                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center">
                                <Ellipse Width="6"
                                         Height="6"
                                         Fill="Black"
                                         Margin="2" />
                                <Ellipse Width="6"
                                         Height="6"
                                         Fill="Black"
                                         Margin="2" />
                                <Ellipse Width="6"
                                         Height="6"
                                         Fill="Black"
                                         Margin="2" />
                            </StackPanel>
                        </Button>
                    </Border>
                </Grid>


                <!-- On searching animation -->


                <!-- Result Container -->
                <ItemsControl Grid.Row="2"
                              ItemsSource="{Binding ResultsList,IsAsync=True}"
                              HorizontalAlignment="Center"
                              Background="Transparent"
                              MaxWidth="1100"
                              Margin="0,0,0,20">

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Episode}">
                            <views:EpisodeView />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                </ItemsControl>


            </Grid>
            <!--Save toast notification -->
            <Border x:Name="SaveToast"
        Background="#333"
        CornerRadius="8"
        Padding="12,6"
        HorizontalAlignment="Center"
        VerticalAlignment="Top"
        Margin="0,20,0,0"
        Opacity="0">
                <TextBlock Text="Sparad!"
               Foreground="White"
               FontSize="16"
               FontWeight="Bold"/>
            </Border>

        </Grid>
    </ScrollViewer>
</Page>
